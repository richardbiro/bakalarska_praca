\chapter{Známe otvorené problémy}

\label{kap:openproblems} % id kapitoly pre prikaz ref

\section{Magické štvorce}

\begin{hypothesis} Existuje jediný magický štvorec veľkosti $3 \times 3$ (spolu s jeho násobkami, rotáciami a symetriami), ktorého aspoň $7$ prvkov sú druhé mocniny kladných celých čísel.
\end{hypothesis}

Najskôr ukážeme, že prvky v magickom štvorci veľkosti $3 \times 3$ spĺňajú isté vzťahy:

\begin{theorem} Nech $e$ je prostredným prvkom magického štvorca veľkosti $3 \times 3$. Potom je magický súčet rovný $3e$.
\end{theorem}

\begin{proof} Nech $s$ je magický súčet. Označme $a, b, \dots , i$ prvky štvorca zľava doprava po jednotlivých riadkoch (čiže $e$ je prostredným z nich). Potom platí $3s = (a + e + i) + (b + e + h) + (c + e + g) = (a + b + c) + (g + h + i) + 3e = 2s + 3e$, z čoho vyplýva, že $s = 3e$.
\end{proof}

\begin{consequence}
\label{square3x3xy}
Nech $e$ je prostredným prvkom magického štvorca veľkosti $3 \times 3$ a $x,y$ sú jeho ľubovoľné dva protiľahlé prvky. Potom $x + y = 2e$.
\end{consequence}

\begin{consequence}
\label{square3x3afh}
Nech $z$ je prvok v ľubovoľnom rohu magického štvorca veľkosti $3 \times 3$ a $x,y$ sú prvky, ktoré susedia stranou s jeho protiľahlým rohom. Potom $x + y = 2z$.
\end{consequence}

\begin{proof} Opäť označme $a, b, \dots , i$ prvky štvorca zľava doprava po jednotlivých riadkoch. Dokážeme iba vzťah $f + h = 2a$, ostatné z nich sú analogické. Platí $c + f + i = g + h + i = 3e$ a zároveň $a + i = c + g = 2e$ (na základe vety \ref{square3x3xy}). Z prvého vzťahu vyjadríme $c = 3e - f - i, g = 3e - h - i$ a z druhého $a = 2e - i$. Dosadením do $c + g = 2e$ dostaneme $2(2e - i) = f + h$, čím je rovnosť $2a = f + h$ dokázaná.
\end{proof}

Nasledovná lema sa nám zíde pri vytváraní parametrických vzorcov \cite{algebraic}:

\begin{lemma}
\label{square3x3pqrs}
Všetky celočíselné riešenia rovnice $a^2 + b^2 = c^2 + d^2$ majú parametrické vyjadrenie $a = pr + qs, b = qr - ps, c = ps + qr, d = pr - qs$, kde $p,q,r,s \in \mathbb{Z}$.
\end{lemma}

Z nej dokážeme odvodiť parametrické vyjadrenie pre modifikovanú rovnicu:

\begin{lemma} 
\label{square3x3uvw}
Nech $a,b,c$ sú kladné celé čísla, pre ktoré platí $a^2 + b^2 = 2c^2$. Potom existujú $u,v,w \in \mathbb{N}$ také, že $a = w(u^2 + 2uv - v^2), b = w(- u^2 + 2uv + v^2), c = w(u^2 + v^2)$.
\end{lemma}

\begin{proof} 
Aplikovaním lemy \ref{square3x3pqrs} na rovnicu $a^2 + b^2 = c^2 + c^2$ dostaneme vzťahy $a = pr + qs, b = qr - ps, c = ps + qr = pr - qs$ pre nejaké $p,q,r,s \in \mathbb{Z}$. Keď vyjadríme $s = r \frac{p-q}{p+q}$ a dosadíme do $a,b,c$, dostaneme $a =  \frac{r}{p+q} (p^2 + 2pq - q^2), b = \frac{r}{p+q} (-p^2 + 2pq + q^2), c = \frac{r}{p+q} (p^2 + q^2)$. Keď použijeme substitúciu $u = p, v = q, w = \frac{r}{p+q}$ (čo môžeme, pretože hodnotu výrazu $\frac{r}{p+q}$ vieme regulovať premennou $r$), získame hľadanú parametrizáciu.
\end{proof}

Z parametrického riešenia rovnice $a^2 + b^2 = 2c^2$ vieme odvodiť nasledovný vzorec:

\begin{theorem}
\label{3x3square5squares}
Nech $u_1, v_1, u_2, v_2$ sú navzájom rôzne kladné celé čísla. Definujme hodnoty $p,q,r,s,t$ nasledovne:
\begin{gather*}
p = (u_1^2 + v_1^2)(u_2^2 + 2u_2 v_2 - v_2^2) \\
q = (u_1^2 + 2u_1 v_1 - v_1^2)(u_2^2 + v_2^2) \\
r = (- u_1^2 + 2u_1 v_1 + v_1^2)(u_2^2 + v_2^2) \\
s = (u_1^2 + v_1^2)(-u_2^2 + 2u_2 v_2 + v_2^2) \\
t = (u_1^2 + v_1^2)(u_2^2 + v_2^2)
\end{gather*}

Potom vieme zostrojiť nasledovné magické štvorce, ktorých aspoň $5$ prvkov sú druhé mocniny kladných celých čísel:
\end{theorem}

\begin{center}
$\begin{array}{ |c|c|c| } 
\hline
p^2 & 3t^2 - p^2 - q^2 & q^2 \\ 
\hline
3t^2 - p^2 - r^2 & t^2 & 3t^2 - q^2 - s^2 \\ 
\hline
r^2 & 3t^2 - r^2 - s^2 & s^2 \\
\hline
\end{array}$
{}
$\begin{array}{ |c|c|c| } 
\hline
2(r^2 + s^2) & 4p^2 & 2(q^2 + s^2) \\ 
\hline
4q^2 & 4t^2 & 4r^2 \\ 
\hline
2(p^2 + r^2) & 4s^2 & 2(p^2 + q^2) \\
\hline
\end{array}$
\end{center}
\begin{center}
$\begin{array}{ |c|c|c| } 
\hline
p^2 & q^2 & 3t^2 - p^2 - q^2 \\ 
\hline
r^2 + s^2 - p^2 & t^2 & p^2 + q^2 - s^2 \\ 
\hline
3t^2 - r^2 - s^2 & r^2 & s^2 \\
\hline
\end{array}$
{}
$\begin{array}{ |c|c|c| } 
\hline
p^2 & r^2 & 3t^2 - p^2 - r^2 \\ 
\hline
q^2 + s^2 - p^2 & t^2 & p^2 + r^2 - s^2 \\ 
\hline
3t^2 - q^2 - s^2 & q^2 & s^2 \\
\hline
\end{array}$
\end{center}

\begin{proof}
Na základe vety \ref{square3x3uvw} vidíme, že platí $p^2 + s^2 = q^2 + r^2 = 2t^2$. Dokážeme konštrukciu prvého štvorca, zvyšné prípady sú analogické. Uvažujme štvorec v nasledovnom tvare:

\begin{center}
$\begin{array}{ |c|c|c| } 
\hline
p^2 & - & q^2 \\ 
\hline
- & t^2 & - \\ 
\hline
r^2 & - & s^2 \\
\hline
\end{array}$
\end{center}

Podľa vety \ref{square3x3xy} vidíme, že podmienka $p^2 + s^2 = q^2 + r^2 = 2t^2$ je zachovaná. Dopočítaním zvyšných prvkov dostaneme platný magický štvorec veľkosti $3 \times 3$, ktorého aspoň $5$ prvkov sú druhé mocniny kladných celých čísel.
\end{proof}

Na základe objaveného parametrického vzorca sme implementovali algoritmus \ref{algsquare3x3uvw}.

\begin{result} Pre $u_1, v_1, u_2, v_2 < 1000$ dokáže parametrický vzorec vygenerovať iba jeden magický štvorec veľkosti $3 \times 3$, ktorého aspoň $7$ prvkov sú druhé mocniny kladných celých čísel (ten, ktorý už poznáme). Dosiahneme ho napr. pre $u_1 = 3, v_1 = 4, u_2 = 2, v_2 = 9$ a vydelením prvkov ich spoločným deliteľom.
\end{result}

Zameriame sa aj na špecifické parametrické vzorce, ktoré generujú magické štvorce veľkosti $3 \times 3$ s aspoň $6$ druhými mocninami kladných celých čísel. V roku $2019$ objavil Arkadiusz Wesolowski nasledovný vzorec pre $n \in \mathbb{N}, w = 6n^2 + 6n + 2, x = 2n + 1, y = 3n^2 + 2n, z = 3n^2 + 4n + 1, k = x^2 y^2 + w^2 z^2$ \cite{multimagie}:

\begin{center}
$\begin{array}{ |c|c|c| } 
\hline
(wz + xy)^2 & (wy - xz)^2 & (2y^2 - z^2)x^2 + (2z^2 - y^2)w^2 \\ 
\hline
2k - (wy + xz)^2 & k & (wy + xz)^2 \\ 
\hline
x^2 z^2 + w^2 y^2 & 2k - (wy - xz)^2 & (wz - xy)^2 \\
\hline
\end{array}$
\end{center}

Na konštrukciu našich parametrických vzorcov využijeme nasledovnú identitu \cite{algebraic}:

%\begin{lemma} Nech $m,n \in \mathbb{Z}$. Nech $a = m^2 + 2n^2, b = 2mn, c = m^2 - 2n^2, p = 3a + 4b, q = a+2b$. Nech $x = a(a+b)p - 2c^2q, y = a(a+b)p + 2c^2q, z = acp + 2cq^2$. Potom sú výrazy $- x^2 + y^2 + z^2, x^2 - y^2 + z^2$ aj $x^2 + y^2 - z^2$ štvorce.
%\end{lemma}

\begin{lemma}
\label{square3x3x}
Nech $x \in \mathbb{Z}$. Nech $a = x^5 - 2x, b = x^5 + x, c = -2x^4 + 1, d = x^4 + 1$. Potom $ab(a^2 - b^2) = cd(c^2 - d^2)$.
\end{lemma}

\begin{theorem}
\label{3x3square6squares}
Nech $x$ je kladné celé číslo. Nech $x_1 = 8x^8 - 49x^6 + 6x^4 - 16x^2 + 2, x_2 = 8x^8 - x^6 + 30x^4 - 40x^2 + 2, x_3 = 8x^8 - 25x^6 + 18x^4 - 28x^2 + 2$. Potom vieme zostrojiť nasledovné magické štvorce veľkosti $3 \times 3$, ktorých aspoň $6$ prvkov sú druhé mocniny kladných celých čísel.
\end{theorem}

\begin{center}
$\begin{array}{ |c|c|c| } 
\hline
(2x^5 + 4x^3 - 7x)^2 & x_1(x^2 - 2) & (5x^4 - 2x^2 + 2)^2 \\ 
\hline
(x^4 + 8x^2 - 2)^2 & (2x^5 - 2x^3 + 5x)^2 & x_2(x^2 - 2) \\ 
\hline
x_3(x^2 - 2) & (7x^4 - 4x^2 - 2)^2 & (2x^5 - 8x^3 - x)^2 \\
\hline
\end{array}$
\end{center}
\begin{center}
$\begin{array}{ |c|c|c| } 
\hline
(5x^4 - 2x^2 + 2)^2 & (2x^5 + 4x^3 - 7x)^2 & \frac{4x^{10} - 31x^8 + 76x^6 + 76x^4 - 31x^2 + 4}{2}\\ 
\hline
(2x^5 - 8x^3 - x)^2 & \frac{4x^{10} + 17x^8 + 4x^6 + 4x^4 + 17x^2 + 4}{2} & (7x^4 - 4x^2 - 2)^2 \\ 
\hline
\frac{4x^{10} + 65x^8 - 68x^6 - 68x^4 + 65x^2 + 4}{2} & (x^4 + 8x^2 - 2)^2 & (2x^5 - 2x^3 + 5x)^2 \\
\hline
\end{array}$
\end{center}

\begin{proof} 
Uvažujme nasledovný magický štvorec veľkosti $3 \times 3$, ktorého aspoň $6$ prvkov sú druhé mocniny kladných celých čísel: \\

\begin{center}
$\begin{array}{ |c|c|c| } 
\hline
a^2 & - & e^2 \\ 
\hline
b^2 & f^2 & - \\ 
\hline
- & c^2 & d^2 \\
\hline
\end{array}$
\end{center}

Z dôsledku \ref{square3x3afh} vyplýva, že $b^2 + c^2 = 2e^2$. Aplikovaním lemy \ref{square3x3uvw} zistíme, že $b = w(u^2 + 2uv - v^2), c = w(- u^2 + 2uv + v^2), e = w(u^2 + v^2)$ pre nejaké $u,v,w \in \mathbb{N}$. Označme $N = \frac{b^2 - c^2}{2}$. Potom:
\begin{gather*}
N = \frac{w^2(u^2 + 2uv - v^2)^2 - w^2(- u^2 + 2uv + v^2)^2}{2} = 4uv(u^2 - v^2)w^2
\end{gather*}

Z dôsledku \ref{square3x3afh} vyplýva, že $d^2 + a^2 = 2f^2$. Aplikovaním lemy \ref{square3x3uvw} zistíme, že $d = w_2(u_2^2 + 2u_2 v_2 - v_2^2), a = w_2(- u_2^2 + 2u_2 v_2 + v_2^2), f = w_2(u_2^2 + v_2^2)$ pre nejaké $u_2,v_2,w_2 \in \mathbb{N}$. Zároveň platí $a^2 + b^2 = c^2 + d^2 = e^2 + f^2$, z čoho vyplývajú vzťahy $d^2 = a^2 + b^2 - c^2, f^2 = a^2 + b^2 - \frac{b^2 + c^2}{2} = a^2 + \frac{b^2 - c^2}{2}$.  Potom $a^2 + 2N = d^2$ a $a^2 + N = f^2$. Teda platí $d^2 - f^2 = N$. Po dosadení do $d,f,N$ dostaneme nasledujúcu rovnosť:
\begin{gather*}
w_2^2(u_2^2 + 2u_2 v_2 - v_2^2)^2 - w_2^2(u_2^2 + v_2^2)^2 = 4u v(u^2 - v^2)w^2 \\
w_2^2 u_2 v_2 (u_2^2 - v_2^2) = w^2 uv (u^2 - v^2)
\end{gather*}
 
Uvažujme špeciálny prípad $w = w_2$. Potom dostaneme vzťah $u_2 v_2 (u_2^2 - v_2^2) = uv (u^2 - v^2)$, pričom z lemy \ref{square3x3x} vieme, že jedno z jeho parametrických riešení je $u_2 = p^5 + p, v_2 = p^5 - 2p, u = -2p^4 + 1, v = p^4 + 1$ pre $p \in \mathbb{Z}$. Po spätnom dosadení do $a,b,c,d,e,f$, substitúcii $x = p^2$ a dopočítaní zvyšných prvkov dostaneme prvý štvorec. \\

Druhý štvorec získame tak, že prvý

\begin{center}
$\begin{array}{ |c|c|c| } 
\hline
a & b & c \\ 
\hline
d & e & f \\ 
\hline
g & h & i \\
\hline
\end{array}$
\end{center}

transformujeme na

\begin{center}
$\begin{array}{ |c|c|c| } 
\hline
c & a & \frac{d+i}{2} \\ 
\hline
i & \frac{c+e}{2} & h \\ 
\hline
\frac{a+h}{2} & d & e \\
\hline
\end{array}$
\end{center}
\end{proof}

Na základe objaveného parametrického vzorca sme implementovali algoritmus \ref{algsquare3x3x}.

\begin{result} Pre $x = 1$ dostaneme štvorec, ktorého prvky nie sú navzájom rôzne. Pre $1 < x < 10^8$ nedokážu parametrické vzorce vygenerovať magický štvorec veľkosti $3 \times 3$, ktorého aspoň $7$ prvkov sú druhé mocniny prirodzených čísel.
\end{result}

\section{Bimagické štvorce}

\begin{hypothesis} Neexistuje bimagický štvorec veľkosti $5 \times 5$.
\end{hypothesis}

V predchádzajúcej kapitole sme uviedli, že neexistenciu menších bimagických štvorcov už dokázali Eduard Lucas, Luke Pebody a Jean-Claude Rosa. Lee Morgenstern neskôr dokázal tieto tvrdenia jednoduchšie pomocou duplikačnej lemy \cite{multimagie}:

\begin{lemma} (Duplikačná) Nech $a,b,c,d \in \mathbb{N^+}$, pre ktoré platí $a + b = c + d$ a buď $a^2 + b^2 = c^2 + d^2$, alebo $ab = cd$. Potom $c = a$ alebo $c = b$.
\end{lemma}
 
\begin{proof} Z prvej rovnice vyjadríme $d = a + b - c$ a dosadíme do rovnice $a^2 + b^2 = c^2 + d^2$ alebo do rovnice $ab = cd$. Po úprave dostaneme vzťah $c^2 - ac - bc + ab = 0$, ktorý sa dá prepísať na tvar $(c - a)(c - b) = 0$. Z toho vyplýva $c = a$ alebo $c = b$.
\end{proof} 

\begin{theorem} (Morgenstern, 2007) Neexistuje bimagický štvorec veľkosti $3 \times 3$.
\end{theorem}

\begin{proof} Sporom. Nech $a,b$ sú prvky v prvom riadku a prvých dvoch stĺpcoch. Nech $c,d$ sú prvky v poslednom stĺpci a posledných dvoch riadkoch. Nech $x$ je prvok v prvom riadku a poslednom stĺpci. Potom musia platiť vzťahy $a + b + x = x + c + d$ aj $a^2 + b^2 + x^2 = x^2 + c^2 + d^2$. Tým dostaneme sústavu z duplikačnej lemy, z čoho vyplýva, že $c = a$ alebo $c = b$, čo je spor.
\end{proof} 

\begin{theorem} (Morgenstern, 2007) Neexistuje bimagický štvorec veľkosti $4 \times 4$.
\end{theorem}

\begin{proof} Sporom. Nech $a, b, \dots , o, p$ sú prvky zľava doprava v jednotlivých riadkoch štvorca. Keďže štvorec je magický, musia platiť nasledovné vzťahy:
\begin{gather*}
a + b + c + d = m + n + o + p \\
a + f + k + p = b + f + j + n \\
d + g + j + m = c + g + k + o
\end{gather*}

Ich sčítaním dostaneme $a + d = n + o$. Keďže štvorec je zároveň aj bimagický, musia platiť nasledovné vzťahy:
\begin{gather*}
a^2 + b^2 + c^2 + d^2 = m^2 + n^2 + o^2 + p^2 \\
a^2 + f^2 + k^2 + p^2 = b^2 + f^2 + j^2 + n^2 \\
d^2 + g^2 + j^2 + m^2 = c^2 + g^2 + k^2 + o^2
\end{gather*}

Ich sčítaním dostaneme $a^2 + d^2 = n^2 + o^2$. Tým dostaneme sústavu z duplikačnej lemy, z čoho vyplýva, že $n = a$ alebo $n = d$, čo je spor.
\end{proof} 

Morgenstern okrem toho hľadal bimagické štvorce veľkosti $5 \times 5$ svojou výpočtovou metódou a prišiel k nasledujúcemu zisteniu \cite{multimagie}:

\begin{theorem} (Morgenstern, 2014) Neexistuje bimagický štvorec veľkosti $5 \times 5$, ktorého prvky neprevyšujú $1500$.
\end{theorem}

Jeho metóda spočívala v nájdení štvoríc navzájom rôznych kladných celých čísel $(A,G,S,Y), (C,H,R,W), (E,I,Q,U)$, pre ktoré platí:
\begin{gather*}
A+G+S+Y = C+H+R+W = E+I+Q+U \\
A^2+G^2+S^2+Y^2 = C^2+H^2+R^2+W^2 = E^2+I^2+Q^2+U^2
\end{gather*}

Na základe týchto hodnôt dopočítal zvyšné prvky štvorca:

\begin{center}
$\begin{array}{ |c|c|c|c|c| }
\hline
A & b & C & d & E \\ 
\hline
f & G & H & I & j  \\ 
\hline
k & l & m & n & o \\ 
\hline
p & Q & R & S & t \\ 
\hline
U & v & W & x & Y \\
\hline
\end{array}$
\end{center}

Chceli sme zefektívniť Morgensternov algoritmus. Urobili sme niekoľko pozorovaní. Je zrejmé, že magické štvorce sú uzavreté na kladný celočíselný násobok. Z nasledovnej lemy vyplýva, že sú uzavreté aj na konštantný posun:

\begin{lemma} (Posunová) Nech $n \in \mathbb{N}$. Nech $a_1, \dots , a_n, b_1, \dots , b_n \in \mathbb{N}$. Ak $\sum_{k=1}^{n} a_k = \sum_{k=1}^{n} b_k$ aj $\sum_{k=1}^{n} a^2_k = \sum_{k=1}^{n} b^2_k$, potom pre všetky $x \in \mathbb{Z}$ platí:
\begin{gather*}
\sum_{k=1}^{n} (a_k + x) = \sum_{k=1}^{n} (b_k + x) \\
\sum_{k=1}^{n} (a_k + x)^2 = \sum_{k=1}^{n} (b_k + x)^2
\end{gather*}
\end{lemma}
 
\begin{proof}
\begin{gather*}
\sum_{k=1}^{n} (a_k + x) = \sum_{k=1}^{n} a_k + nx = \sum_{k=1}^{n} b_k + nx = \sum_{k=1}^{n} (b_k + x)
\end{gather*}
\begin{gather*}
\sum_{k=1}^{n} (a_k + x)^2 = \sum_{k=1}^{n} a^2_k + 2x \sum_{k=1}^{n} a_k + nx^2 = \sum_{k=1}^{n} b^2_k + 2x \sum_{k=1}^{n} b_k + nx^2 = \sum_{k=1}^{n} (b_k + x)^2
\end{gather*}
\end{proof}

\begin{consequence} Nech $X$ je bimagický štvorec. Nech $a,b \in \mathbb{Z}$, pričom $a \neq 0$. Potom $aX + b$ je bimagický štvorec s potenciálne zápornými prvkami.
\end{consequence}

Vďaka tomu vieme definovať normálne formy bimagických štvorcov. Nech $n$ je veľkosť daného útvaru. Potom:

\begin{theorem}
\label{5x5bimagic1}
Nech $X$ je bimagický štvorec s magickým súčtom $S$, veľkosťou $n$ a najmenším prvkom $x_{min}$. Nech $a,b \in \mathbb{Z}$, pričom $a \neq 0$. Potom:
\begin{enumerate}
\item Ak $a = 1, b = 1 - x_{min}$, tak $aX+b$ je bimagický štvorec, ktorého najmenší prvok je $1$.
%\item Ak $a = -2, b = x_{min} + x_{max}$, tak $aX+b$ je bimagický štvorec s potenciálne zápornými prvkami, ktorého najmenší prvok má opačnú hodnotu ako najväčší prvok.
\item Ak $a = -n, b = S$, tak $aX+b$ je bimagický štvorec s potenciálne zápornými prvkami, ktorého magický súčet je $0$.
\item Ak $a = 1-n, b = S-x$, tak $aX+b$ je bimagický štvorec s potenciálne zápornými prvkami, ktorého magický súčet je rovný danému prvku $x$.
\end{enumerate}
\end{theorem}

\begin{proof}
Výpočtom.
\end{proof}

%\begin{enumerate}
%\item útvar, ktorého najmenší prvok je $0$: zvolíme $a = 1, b = - x_{min}$, kde $x_{min}$ je najmenší prvok pôvodného útvaru
%\item útvar, ktorého najmenší prvok je $1$: zvolíme $a = 1, b = 1 - x_{min}$
%\item útvar, ktorého najmenší prvok má opačnú hodnotu ako najväčší prvok: zvolíme $a = -2, b = x_{min} + x_{max}$
%\item útvar, ktorého magický súčet je $0$: zvolíme $a = -n, b = S$, kde $S$ je magický súčet pôvodného útvaru
%\item útvar, ktorého magický súčet je rovný danému prvku $x$: zvolíme $a = 1-n, b = S-x$
%\item útvar, ktorého bimagický súčet je rovný $nx^2$ pre daný prvok $x$: za predpokladu $S \neq nx$ zvolíme $a = 2(nx - S), b = T - nx^2$
%\end{enumerate}

%\begin{theorem} Nech $A$ je semibimagický štvorec veľkosti $5 \times 5$. Potom existuje číslo $x \in \mathbb{N}$, pre ktoré vieme zostrojiť semibimagický štvorec $B$ rovnakej veľkosti, pričom platí:
%\begin{enumerate}
%\item v prvom riadku $B$ sú v poradí prvky $x, a+b-c, a-b+c, -a+b+c, -a-b-c$, pričom $a,b,c \in \mathbb{N}$
%\item v prvom stĺpci $B$ sú v poradí prvky $x, d+e-f, d-e+f, -d+e+f, -d-e-f$, pričom $d,e,f \in \mathbb{N}$
%\end{enumerate}
%\end{theorem}

%\begin{proof} Uvažujme magický štvorec veľkosti $5 \times 5$, ktorého súčet prvých $4$ prvkov v prvom riadku je rovný $0$. Ak sú prvé $3$ prvky $A, B, C$, tak posledný musí byť $-A-B-C$. Ich bimagický súčet je potom $A^2 + B^2 + C^2 + (-A-B-C)^2 = (A+B)^2 + (A+C)^2 + (B+C)^2$. Nech $a = A+B, b = A+C, c = B+C$. %Potom $A = \frac{a+b-c}{2}, B = \frac{a-b+c}{2}, C = \frac{a+b-c}{2}$. Rovnako odvodíme, že ak sú v poslednom stĺpci prvé $3$ prvky $D, E, F$, tak $D = \frac{d+e-f}{2}, E = \frac{d-e+f}{2}, F = \frac{d+e-f}{2}$ pre vhodné $d,e,f$. Všetky prvky $A, B, C, D, E, F$ vynásobíme $2$ a môžeme ich v danom riadku alebo stĺpci %ľubovoľne premiestňovať (keďže sme v semibimagickom štvorci).
%\end{proof}

Budeme predpokladať, že bimagický štvorec má magický súčet rovný prostrednému prvku. To využijeme pri dôkaze nasledovných viet:

\begin{theorem}
\label{5x5bimagic2}
Nech $A, B, C, D, E, F, G, H$ sú navzájom rôzne celé čísla, pričom:
\begin{gather*}
A + B + C + D = E + F + G + H = 0 \\
A^2 + B^2 + C^2 + D^2 = E^2 + F^2 + G^2 + H^2
\end{gather*}

Potom existujú $a,b,c,e,f,g \in \mathbb{Z}$ také, že:
\begin{gather*}
a^2 + b^2 + c^2 = e^2 + f^2 + g^2 \\
(2A,2B,2C,2D) = (-a+b+c, a-b+c,a+b-c, -a-b-c) \\
(2E,2F,2G,2H) = (-e+f+g, e-f+g, e+f-g, -e-f-g)
\end{gather*}

\end{theorem}

\begin{proof} Dosadením $D = -A-B-C, H = -E-F-G$ do druhej rovnice dostaneme vzťah $A^2 + B^2 + C^2 + (-A-B-C)^2 = E^2 + F^2 + G^2 + (-E-F-G)^2$. Ten sa dá upraviť na tvar $(A+B)^2 + (A+C)^2 + (B+C)^2 = (E+F)^2 + (E+G)^2 + (F+G)^2$. Nech $a = A+B, b = A+C, c = B+C, e = E+F, g = E+G, h = F+G$. Potom $a^2 + b^2 + c^2 = e^2 + f^2 + g^2$. Zároveň si vieme sústavou rovníc odvodiť, že $A = \frac{-a+b+c}{2}, B = \frac{a-b+c}{2}, C = \frac{a+b-c}{2}, E = \frac{-e+f+g}{2}, F = \frac{e-f+g}{2}, G = \frac{e+f-g}{2}$. Spätným dosadením zistíme, že $D = \frac{-a-b-c}{2}, H = \frac{-e-f-g}{2}$, čím je dôkaz ukončený.
\end{proof}

\begin{theorem}
\label{5x5bimagic3}
Nech $K \in \mathbb{N}$. Nech $A_1, A_2, A_3, A_4, B_1, B_2, B_3, B_4, C_1, C_2, C_3, C_4$ sú navzájom rôzne celé čísla, pričom:
\begin{gather*}
A_1 + A_2 + A_3 + A_4 = B_1 + B_2 + B_3 + B_4 = C_1 + C_2 + C_3 + C_4 = 0 \\
A_1^2 + A_2^2 + A_3^2 + A_4^2 = B_1^2 + B_2^2 + B_3^2 + B_4^2 = C_1^2 + C_2^2 + C_3^2 + C_4^2 = K
\end{gather*}

Nech $x,y \in \mathbb{Z}$. Potom existuje iba konečne veľa $s \in \mathbb{Z}$, pre ktoré je nasledujúca časť štvorca veľkosti $5 \times 5$ bimagická: 

\begin{center}
$\begin{array}{ |c|c|c|c|c| }
\hline
A_1 & x & B_1 & y & C_1 \\ 
\hline
- & A_2 & B_2 & C_2 & -  \\ 
\hline
- & - & s & - & - \\ 
\hline
- & C_3 & B_3 & A_3 & - \\ 
\hline
C_4 & - & B_4 & - & A_4 \\ 
\hline
\end{array}$
\end{center}

\end{theorem}

\begin{proof} Prvý riadok má magický súčet $A_1 + B_1 + C_1 + x + y$ a bimagický súčet $A_1^2 + B_1^2 + C_1^2 + x^2 + y^2$. Prostredný stĺpec má magický súčet $s$ a bimagický súčet $s^2 + K$. Z toho vyplýva, že musia platiť nasledovné vzťahy:
\begin{gather*}
A_1 + B_1 + C_1 + x + y = s \\
A_1^2 + B_1^2 + C_1^2 + x^2 + y^2 = s^2 + K
\end{gather*}

Z prvého vyjadríme $y = s - A_1 - B_1 - C_1 - x$. Dosadením vznikne vzťah $A_1^2 + B_1^2 + C_1^2 + x^2 + (s - A_1 - B_1 - C_1 - x)^2 = s^2 + K$, ktorý sa dá upraviť na tvar $x^2 - x[s - (A_1 + B_1 + C_1)] - s(A_1 + B_1 + C_1) + A_1^2 + B_1^2 + C_1^2 + A_1 B_1 + A_1 C_1 + B_1 C_1 + \frac{K}{2} = 0$. Nech $S^\prime = A_1 + B_1 + C_1$. Riešením tejto kvadratickej rovnice je:
\begin{gather*}
x = \frac{s - S^\prime \pm \sqrt{(s + S^\prime)^2 - 4(A_1^2 + B_1^2 + C_1^2 + A_1 B_1 + A_1 C_1 + B_1 C_1 + \frac{K}{2})}}{2}
\end{gather*}

Keďže $x \in \mathbb{Z}$, nutne $(s + S^\prime)^2 - 4(A_1^2 + B_1^2 + C_1^2 + A_1 B_1 + A_1 C_1 + B_1 C_1 + \frac{K}{2}) = n^2$ pre nejaké $n \in \mathbb{N}$. Po úprave dostaneme nasledovný vzťah:
\begin{gather*}
(s + n + S^\prime)(s - n + S^\prime) = 4(A_1^2 + B_1^2 + C_1^2 + A_1 B_1 + A_1 C_1 + B_1 C_1 + \frac{K}{2})
\end{gather*}

Keďže všetky výrazy sú celé čísla, existuje iba konečný počet rozkladov čísla $4(A_1^2 + B_1^2 + C_1^2 + A_1 B_1 + A_1 C_1 + B_1 C_1 + \frac{K}{2})$ na dva prvočinitele, z čoho vyplýva, že existuje iba konečný počet vyhovujúcich $s$ (ktoré môžeme nájsť faktorizáciou).
\end{proof}

Podľa predošlých viet vieme implementovať efektívejší algoritmus \ref{algsquare5x5b} na hľadanie bimagických štvorcov veľkosti $5 \times 5$. 

\begin{result} Pre $h < 12500$ neexistuje bimagický štvorec veľkosti $5 \times 5$. Našli sme štyri magické štvorce veľkosti $5 \times 5$ so zápornými prvkami, ktoré majú iba tri zlé bimagické súčty:
\end{result}

\begin{center}
$\begin{array}{ |c|c|c|c|c| }
\hline
58 & 30 & -10 & -232 & -76 \\ 
\hline
-234 & -80 & 44 & 26 & 14  \\ 
\hline
160 & -18 & -230 & -74 & -68 \\ 
\hline
-198 & 66 & 48 & -12 & -134 \\ 
\hline
-16 & -228 & -82 & 62 & 34 \\ 
\hline
\end{array}$
{}
$\begin{array}{ |c|c|c|c|c| } 
\hline
58 & 30 & -10 & -232 & -76 \\ 
\hline
-234 & -80 & 44 & 26 & 14  \\ 
\hline
96 & -18 & -230 & -74 & -4 \\ 
\hline
-134 & 66 & 48 & -12 & -198 \\ 
\hline
-16 & -228 & -82 & 62 & 34 \\ 
\hline
\end{array}$
\end{center}
\begin{center}
$\begin{array}{ |c|c|c|c|c| }
\hline
58 & 30 & -10 & -232 & -76 \\ 
\hline
14 & -80 & 44 & 26 & -234 \\ 
\hline
-88 & -18 & -230 & -74 & 180 \\ 
\hline
-198 & 66 & 48 & -12 & -134 \\ 
\hline
-16 & -228 & -82 & 62 & 34 \\ 
\hline
\end{array}$
{}
$\begin{array}{ |c|c|c|c|c| } 
\hline
58 & 30 & -10 & -232 & -76 \\ 
\hline
14 & -80 & 44 & 26 & -234 \\ 
\hline
-152 & -18 & -230 & -74 & 244 \\ 
\hline
-134 & 66 & 48 & -12 & -198 \\ 
\hline
-16 & -228 & -82 & 62 & 34 \\ 
\hline
\end{array}$
\end{center}

\section{Multiplikatívne magické štvorce}

\begin{hypothesis} Neexistuje multiplikatívny magický štvorec veľkosti $5 \times 5$ alebo $6 \times 6$.
\end{hypothesis} 

\begin{theorem} (Morgenstern, 2007) Neexistuje multiplikatívny magický štvorec veľkosti $3 \times 3$.
\end{theorem}

\begin{proof} Sporom. Nech $a,b$ sú prvky v prvom riadku a prvých dvoch stĺpcoch. Nech $c,d$ sú prvky v poslednom stĺpci a posledných dvoch riadkoch. Nech $x$ je prvok v prvom riadku a poslednom stĺpci. Potom musia platiť vzťahy $a + b + x = x + c + d$ aj $abx = xcd$. Tým dostaneme sústavu z duplikačnej lemy, z čoho vyplýva, že $c = a$ alebo $c = b$, čo je spor.
\end{proof}

\begin{theorem} (Morgenstern, 2007) Neexistuje multiplikatívny magický štvorec veľkosti $4 \times 4$.
\end{theorem} 

\begin{proof} Sporom. Nech $a, b, \dots , o, p$ sú prvky zľava doprava v jednotlivých riadkoch štvorca. Keďže štvorec je magický, musia platiť nasledovné vzťahy:
\begin{gather*}
a + b + c + d = m + n + o + p \\
a + f + k + p = b + f + j + n \\
d + g + j + m = c + g + k + o
\end{gather*}

Ich sčítaním dostaneme $a + d = n + o$. Keďže štvorec je zároveň aj multiplikatívny, musia platiť nasledovné vzťahy:
\begin{gather*}
abcd = mnop \\
afkp = bfjn \\
dgjm = cgko
\end{gather*}

Ich vynásobením dostaneme $ad = no$. Tým dostaneme sústavu z duplikačnej lemy, z čoho vyplýva, že $n = a$ alebo $n = d$, čo je spor.
\end{proof}

Multiplikatívne magické štvorce veľkosti $5 \times 5$ sú už pomerne dobre preskúmané. Christian Boyer dokázal hrubou silou nasledovnú vetu \cite{multimagie}:

\begin{theorem} (Boyer, 2009) Neexistuje multiplikatívny magický štvorec veľkosti $5 \times 5$, ktorého prvky sú menšie ako $1000$ alebo jeho multiplikatívny súčin je menší ako prostredný prvok vynásobený $10^9$.
\end{theorem}

Morgenstern dospel po prehľadávaní štvorcov veľkosti $6 \times 6$ hrubou silou k nasledovnému výsledku \cite{multimagie}:

\begin{theorem} (Morgenstern, 2007) Neexistuje multiplikatívny magický štvorec veľkosti $6 \times 6$, ktorého prvky sú menšie ako $136$.
\end{theorem}

Vzhľadom na veľký pokrok pre veľkosti $5 \times 5$ sme sa sústredili na hľadanie multiplikatívnych magických štvorcov veľkosti $6 \times 6$. Keďže generovanie všetkých potenciálnych riešení by bolo neefektívne, rozhodli sme sa pre aproximačný prístup. Najskôr si zadefinujeme špeciálny pojem, ktorý využijeme pri neskoršej implementácii:

\begin{definition} Nech $S$ je magický alebo multiplikatívny štvorec. Podmnožinu prvkov $V$ nazývame \textbf{vzorkou} ak sa v každom riadku, stĺpci a diagonále nachádza práve jeden prvok z $V$. Ak každý prvok štvorca z $V$ vynásobíme číslom $n \in \mathbb{N^+}$, hovoríme o \textbf{prenásobení vzorky $V$ číslom $n$}.
\end{definition}

Štvorce veľkosti $3 \times 3$ nemajú žiadnu vzorku. Pre veľkosť $4 \times 4$ existuje celkovo $8$ vzoriek: 

\begin{center}
$\begin{array}{ |c|c|c|c| }
\hline
 *  &  &  & \\ 
\hline
 &  &  *  & \\ 
\hline
 &  &  &  * \\
\hline
 &  *  &  & \\
\hline
\end{array}$
{}
$\begin{array}{ |c|c|c|c| }
\hline
 *  &  &  & \\ 
\hline
 &  &  &  * \\ 
\hline
 &  *  &  & \\
\hline
 &  &  *  & \\
\hline
\end{array}$
{}
$\begin{array}{ |c|c|c|c| }
\hline
 &  *  &  & \\ 
\hline
 &  &  *  & \\ 
\hline
 *  &  &  & \\
\hline
 &  &  &  * \\
\hline
\end{array}$
{}
$\begin{array}{ |c|c|c|c| }
\hline
 &  *  &  & \\ 
\hline
 &  &  &  * \\ 
\hline
 &  &  *  & \\
\hline
 *  &  &  & \\
\hline
\end{array}$
\end{center}
\begin{center}
$\begin{array}{ |c|c|c|c| }
\hline
 &  &  *  & \\ 
\hline
 *  &  &  & \\ 
\hline
 &  *  &  & \\
\hline
 &  &  &  * \\
\hline
\end{array}$
{}
$\begin{array}{ |c|c|c|c| }
\hline
 &  &  *  & \\ 
\hline
 &  *  &  & \\ 
\hline
 &  &  &  * \\
\hline
 *  &  &  & \\
\hline
\end{array}$
{}
$\begin{array}{ |c|c|c|c| }
\hline
 &  &  &  * \\ 
\hline
 *  &  &  & \\ 
\hline
 &  &  *  & \\
\hline
 &  *  &  & \\
\hline
\end{array}$
{}
$\begin{array}{ |c|c|c|c| }
\hline
 &  &  &  * \\ 
\hline
 &  *  &  & \\ 
\hline
 *  &  &  & \\
\hline
 &  &  *  & \\
\hline
\end{array}$
\end{center}

Vzorkami vieme generovať multiplikatívne štvorce, o čom hovorí nasledovná veta:

\begin{theorem}
\label{addmultsquarepattern}
Nech $A$ je multiplikatívny štvorec, $V$ je ľubovoľná jeho vzorka a $n$ je kladné celé číslo. Nech $B$ je štvorec, ktorý vznikne prenásobením vzorky $V$ číslom $n$. Potom $B$ je multiplikatívny štvorec.
\end{theorem}

\begin{proof} Každý riadok, stĺpec aj diagonála štvorca $A$ je prenásobená tým istým číslom. Z toho vyplýva, že multiplikatívna vlastnosť zostáva zachovaná.
\end{proof}

\begin{definition} Nech $n$ je kladné celé číslo. Nech $S$ je magický alebo multiplikatívny štvorec veľkosti $n \times n$ a $v_1, \dots , v_n$ sú jeho disjunktné vzorky. Potom nazývame skupinu $v_1, \dots , v_n$ \textbf{štvorcovou vzorkou}.
\end{definition}

Na základe tohto zistenia sme vymysleli algoritmus \ref{algsquare6x6mm}. Ten niekoľkokrát prenásobil jednotkový štvorec veľkosti $6 \times 6$ štvorcovými vzorkami a následne upravoval ich hodnoty tak, aby bola magická odchylka čo najmenšia.

\begin{result} Aproximačná metóda vzorkovaním nenašla žiaden multiplikatívny magický štvorec veľkosti $6 \times 6$. Nasledovný multiplikatívny štvorec mal najmenšie rozpätie súčtov $26$:
\end{result}

\begin{center}
$\begin{array}{ |c|c|c|c|c|c| } 
\hline
150 & 384 & 297 & 78 & 308 & 340 \\ 
\hline
352 & 102 & 120 & 220 & 351 & 420 \\ 
\hline
330 & 252 & 286 & 450 & 136 & 96 \\ 
\hline
459 & 300 & 192 & 336 & 110 & 143 \\ 
\hline
156 & 121 & 140 & 306 & 480 & 360 \\ 
\hline
112 & 390 & 510 & 176 & 180 & 198 \\ 
\hline
\end{array}$
\end{center}

